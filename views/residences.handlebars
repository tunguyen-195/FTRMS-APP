<div class="text-center my-4">
  <h1 class="residence-title">{{t 'residences.title'}}</h1>
</div>

<!-- Toggle Button for Filter -->
<button class="btn btn-secondary mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#filterPanel" aria-expanded="false" aria-controls="filterPanel">
  {{t 'residences.filter.toggle'}}
</button>

<!-- Collapsible Filter Panel -->
<div class="collapse" id="filterPanel">
  <form method="GET" action="/residences" class="mb-4">
    <div class="row justify-content-center align-items-center">
      <div class="col-md-3">
        <label for="district">{{t 'residences.filter.district'}}</label>
        <select name="district" id="district" class="form-control select2">
          <option value="">{{t 'residences.filter.allDistricts'}}</option>
          <!-- Options will be populated by JavaScript -->
        </select>
      </div>
      <div class="col-md-3">
        <label for="ward">{{t 'residences.filter.ward'}}</label>
        <select name="ward" id="ward" class="form-control select2">
          <option value="">{{t 'residences.filter.allWards'}}</option>
          <!-- Options will be populated by JavaScript -->
        </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary">{{t 'residences.filter.submit'}}</button>
      </div>
    </div>
  </form>
</div>

<!-- Tabs navigation -->
<ul class='nav nav-tabs' id='residenceTabs' role='tablist'>
  <li class='nav-item' role='presentation'>
    <button
      class='nav-link active'
      id='pending-tab'
      data-bs-toggle='tab'
      data-bs-target='#pending'
      type='button'
      role='tab'
      aria-controls='pending'
      aria-selected='true'
    >{{t 'residences.statusPending'}}</button>
  </li>
  <li class='nav-item' role='presentation'>
    <button
      class='nav-link'
      id='approved-tab'
      data-bs-toggle='tab'
      data-bs-target='#approved'
      type='button'
      role='tab'
      aria-controls='approved'
      aria-selected='false'
    >{{t 'residences.statusApproved'}}</button>
  </li>
  <li class='nav-item' role='presentation'>
    <button
      class='nav-link'
      id='rejected-tab'
      data-bs-toggle='tab'
      data-bs-target='#rejected'
      type='button'
      role='tab'
      aria-controls='rejected'
      aria-selected='false'
    >{{t 'residences.statusRejected'}}</button>
  </li>
</ul>

<!-- Tabs content -->
<div class='tab-content' id='residenceTabsContent'>
  <div class="tab-pane active" id="pending">
    {{#each residences}}
      {{#if (eq this.status 'Pending')}}
        <div class="card mb-3">
          <div class="card-header">
            <h5>{{this.foreignResident.fullName}}</h5>
          </div>
          <div class="card-body">
            <p><strong>{{t 'residences.full_name'}}:</strong> {{this.foreignResident.fullName}}</p>
            <p><strong>{{t 'residences.nationality'}}:</strong> {{this.foreignResident.nationality}}</p>
            <p><strong>{{t 'residences.accommodation'}}:</strong> {{this.accommodation.name}}</p>
            <p><strong>{{t 'residences.check_in'}}:</strong> {{formatDate this.check_in}}</p>
            <p><strong>{{t 'residences.check_out'}}:</strong> {{formatDate this.check_out}}</p>
            <p><strong>{{t 'residences.reason'}}:</strong> {{this.reason}}</p>
            <p><strong>{{t 'residences.status'}}:</strong> {{this.status}}</p>
            <button class="btn btn-success" data-id="{{this._id}}" data-status="Approved">{{t 'residences.approve'}}</button>
            <button class="btn btn-danger" data-id="{{this._id}}" data-status="Rejected">{{t 'residences.reject'}}</button>
          </div>
        </div>
      {{/if}}
    {{/each}}
  </div>
  <div class="tab-pane" id="approved">
    {{#each residences}}
      {{#if (eq this.status 'Approved')}}
        <div class="card mb-3">
          <div class="card-header">
            <h5>{{this.foreignResident.fullName}}</h5>
          </div>
          <div class="card-body">
            <p><strong>{{t 'residences.full_name'}}:</strong> {{this.foreignResident.fullName}}</p>
            <p><strong>{{t 'residences.nationality'}}:</strong> {{this.foreignResident.nationality}}</p>
            <p><strong>{{t 'residences.accommodation'}}:</strong> {{this.accommodation.name}}</p>
            <p><strong>{{t 'residences.check_in'}}:</strong> {{formatDate this.check_in}}</p>
            <p><strong>{{t 'residences.check_out'}}:</strong> {{formatDate this.check_out}}</p>
            <p><strong>{{t 'residences.reason'}}:</strong> {{this.reason}}</p>
            <p><strong>{{t 'residences.status'}}:</strong> {{this.status}}</p>
            {{!-- <button class="btn btn-success" data-id="{{this._id}}" data-status="Approved">{{t 'residences.approve'}}</button>
            <button class="btn btn-danger" data-id="{{this._id}}" data-status="Rejected">{{t 'residences.reject'}}</button> --}}
          </div>
        </div>
      {{/if}}
    {{/each}}
  </div>
  <div class="tab-pane" id="rejected">
    {{#each residences}}
      {{#if (eq this.status 'Rejected')}}
        <div class="card mb-3">
          <div class="card-header">
            <h5>{{this.foreignResident.fullName}}</h5>
          </div>
          <div class="card-body">
            <p><strong>{{t 'residences.full_name'}}:</strong> {{this.foreignResident.fullName}}</p>
            <p><strong>{{t 'residences.nationality'}}:</strong> {{this.foreignResident.nationality}}</p>
            <p><strong>{{t 'residences.accommodation'}}:</strong> {{this.accommodation.name}}</p>
            <p><strong>{{t 'residences.check_in'}}:</strong> {{formatDate this.check_in}}</p>
            <p><strong>{{t 'residences.check_out'}}:</strong> {{formatDate this.check_out}}</p>
            <p><strong>{{t 'residences.reason'}}:</strong> {{this.reason}}</p>
            <p><strong>{{t 'residences.status'}}:</strong> {{this.status}}</p>
            {{!-- <button class="btn btn-success" data-id="{{this._id}}" data-status="Approved">{{t 'residences.approve'}}</button>
            <button class="btn btn-danger" data-id="{{this._id}}" data-status="Rejected">{{t 'residences.reject'}}</button> --}}
          </div>
        </div>
      {{/if}}
    {{/each}}
  </div>
  {{!-- <div class="tab-pane" id="foreign-residents">
    {{#each foreignResidents}}
      <div class="card mb-3">
        <div class="card-header">
          <h5>{{this.fullName}}</h5>
        </div>
        <div class="card-body">
          <p><strong>{{t 'residences.full_name'}}:</strong> {{this.fullName}}</p>
          <p><strong>{{t 'residences.nationality'}}:</strong> {{this.nationality}}</p>
          <p><strong>{{t 'residences.accommodation'}}:</strong> {{this.accommodation.name}}</p>
          <p><strong>{{t 'residences.passportNumber'}}:</strong> {{this.passportNumber}}</p>
          <p><strong>{{t 'residences.visaType'}}:</strong> {{this.visaType}}</p>
          <p><strong>{{t 'residences.visaExpiryDate'}}:</strong> {{formatDate this.visaExpiryDate}}</p>
        </div>
      </div>
    {{/each}}
  </div> --}}
</div>

<!-- Include Select2 and Bootstrap CSS/JS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<script src="/js/residences.js"></script>